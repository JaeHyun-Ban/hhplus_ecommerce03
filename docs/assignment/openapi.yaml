ㅐㅔopenapi: 3.0.3
info:
  title: E-Commerce API
  description: |
    ## 이커머스 플랫폼 API

    이 API는 이커머스 플랫폼의 핵심 기능을 제공합니다.

    ### 주요 기능
    - 사용자 관리 및 잔액 충전
    - 상품 조회 및 인기 상품 통계
    - 장바구니 관리
    - 주문 생성 및 결제
    - 쿠폰 발급 및 사용

    ### 인증
    JWT Bearer 토큰을 사용합니다.
    ```
    Authorization: Bearer {token}
    ```

    ### 에러 처리
    모든 에러는 일관된 형식으로 반환됩니다.

  version: 1.0.0
  contact:
    name: API Support
    email: support@ecommerce.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:3000
    description: Mock Server (JSON Server) - 프론트엔드 개발용

tags:
  - name: Users
    description: 사용자 관리 API
  - name: Products
    description: 상품 관리 API
  - name: Cart
    description: 장바구니 API
  - name: Orders
    description: 주문 및 결제 API
  - name: Coupons
    description: 쿠폰 관리 API

paths:
  # ========================================
  # User API
  # ========================================
  /users:
    post:
      tags:
        - Users
      summary: 사용자 등록
      description: 새로운 사용자를 등록합니다.
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
            examples:
              example1:
                summary: 일반 사용자 등록
                value:
                  email: user@example.com
                  password: password123
                  name: 홍길동
      responses:
        '201':
          description: 사용자 등록 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'

  /users/{userId}:
    get:
      tags:
        - Users
      summary: 사용자 조회
      description: 사용자 ID로 사용자 정보를 조회합니다.
      operationId: getUser
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /users/{userId}/balance:
    get:
      tags:
        - Users
      summary: 잔액 조회
      description: 사용자의 현재 잔액을 조회합니다.
      operationId: getBalance
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BalanceResponse'

  /users/{userId}/balance/charge:
    post:
      tags:
        - Users
      summary: 잔액 충전
      description: 사용자의 잔액을 충전합니다.
      operationId: chargeBalance
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChargeBalanceRequest'
            examples:
              example1:
                summary: 10,000원 충전
                value:
                  amount: 10000
      responses:
        '200':
          description: 충전 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BalanceHistoryResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /users/{userId}/balance/history:
    get:
      tags:
        - Users
      summary: 잔액 이력 조회
      description: 사용자의 잔액 변동 이력을 조회합니다.
      operationId: getBalanceHistory
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BalanceHistoryPageResponse'

  # ========================================
  # Product API
  # ========================================
  /products:
    get:
      tags:
        - Products
      summary: 상품 목록 조회
      description: 상품 목록을 페이징하여 조회합니다.
      operationId: getProducts
      parameters:
        - name: categoryId
          in: query
          description: 카테고리 ID (선택)
          schema:
            type: integer
            format: int64
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductPageResponse'

  /products/{productId}:
    get:
      tags:
        - Products
      summary: 상품 상세 조회
      description: 상품 ID로 상세 정보를 조회합니다.
      operationId: getProduct
      parameters:
        - $ref: '#/components/parameters/ProductIdPath'
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /products/popular:
    get:
      tags:
        - Products
      summary: 인기 상품 조회
      description: 최근 N일간 판매량 기준 Top 상품을 조회합니다.
      operationId: getPopularProducts
      parameters:
        - name: days
          in: query
          description: 조회 기간 (일)
          schema:
            type: integer
            default: 3
            minimum: 1
            maximum: 30
        - name: limit
          in: query
          description: 조회 개수
          schema:
            type: integer
            default: 5
            minimum: 1
            maximum: 20
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PopularProductResponse'

  /products/{productId}/restock-notifications:
    post:
      tags:
        - Products
      summary: 재입고 알림 신청
      description: 품절 상품에 대한 재입고 알림을 신청합니다.
      operationId: requestRestockNotification
      parameters:
        - $ref: '#/components/parameters/ProductIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
              properties:
                userId:
                  type: integer
                  format: int64
      responses:
        '201':
          description: 신청 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestockNotificationResponse'

  /categories:
    get:
      tags:
        - Products
      summary: 카테고리 목록 조회
      description: 모든 카테고리를 조회합니다.
      operationId: getCategories
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/CategoryResponse'

  # ========================================
  # Cart API
  # ========================================
  /carts/{userId}:
    get:
      tags:
        - Cart
      summary: 장바구니 조회
      description: 사용자의 장바구니를 조회합니다.
      operationId: getCart
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CartResponse'

  /carts/{userId}/items:
    post:
      tags:
        - Cart
      summary: 장바구니에 상품 추가
      description: 장바구니에 상품을 추가합니다.
      operationId: addCartItem
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddCartItemRequest'
      responses:
        '201':
          description: 추가 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CartItemResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

    delete:
      tags:
        - Cart
      summary: 장바구니 비우기
      description: 장바구니의 모든 상품을 제거합니다.
      operationId: clearCart
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
      responses:
        '204':
          description: 삭제 성공

  /carts/{userId}/items/{itemId}:
    patch:
      tags:
        - Cart
      summary: 장바구니 상품 수량 변경
      description: 장바구니 상품의 수량을 변경합니다.
      operationId: updateCartItemQuantity
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
        - name: itemId
          in: path
          required: true
          description: 장바구니 항목 ID
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - quantity
              properties:
                quantity:
                  type: integer
                  minimum: 1
      responses:
        '200':
          description: 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CartItemResponse'

    delete:
      tags:
        - Cart
      summary: 장바구니 상품 삭제
      description: 장바구니에서 특정 상품을 삭제합니다.
      operationId: removeCartItem
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
        - name: itemId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: 삭제 성공

  # ========================================
  # Order API
  # ========================================
  /orders:
    get:
      tags:
        - Orders
      summary: 주문 목록 조회
      description: 사용자의 주문 목록을 조회합니다.
      operationId: getOrders
      parameters:
        - name: userId
          in: query
          required: true
          schema:
            type: integer
            format: int64
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderPageResponse'

    post:
      tags:
        - Orders
      summary: 주문 생성 (결제)
      description: |
        주문을 생성하고 결제를 진행합니다.

        ## 처리 과정
        1. 재고 확인 및 차감
        2. 잔액 확인 및 차감
        3. 쿠폰 적용
        4. 주문 생성
        5. 결제 처리
        6. 외부 시스템 연동 (비동기)

        ## 멱등성
        `idempotencyKey`를 사용하여 중복 주문을 방지합니다.
      operationId: createOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
            examples:
              withCoupon:
                summary: 쿠폰 사용 주문
                value:
                  userId: 1
                  items:
                    - productId: 1
                      quantity: 2
                    - productId: 2
                      quantity: 1
                  userCouponIds:
                    - 1
                  idempotencyKey: order-20251028-123456
              withoutCoupon:
                summary: 쿠폰 미사용 주문
                value:
                  userId: 1
                  items:
                    - productId: 1
                      quantity: 1
                  userCouponIds: []
                  idempotencyKey: order-20251028-123457
      responses:
        '201':
          description: 주문 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: 중복 주문 (idempotencyKey 중복)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}:
    get:
      tags:
        - Orders
      summary: 주문 상세 조회
      description: 주문 ID로 상세 정보를 조회합니다.
      operationId: getOrder
      parameters:
        - $ref: '#/components/parameters/OrderIdPath'
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /orders/{orderId}/cancel:
    post:
      tags:
        - Orders
      summary: 주문 취소
      description: |
        주문을 취소하고 환불을 처리합니다.

        ## 처리 과정
        1. 잔액 환불
        2. 재고 복구
        3. 쿠폰 복구 (유효기간 내)
        4. 주문 상태 변경
        5. 외부 시스템 연동 (비동기)
      operationId: cancelOrder
      parameters:
        - $ref: '#/components/parameters/OrderIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
                  description: 취소 사유
                  example: 단순 변심
      responses:
        '200':
          description: 취소 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  # ========================================
  # Coupon API
  # ========================================
  /coupons:
    get:
      tags:
        - Coupons
      summary: 쿠폰 목록 조회
      description: 발급 가능한 쿠폰 목록을 조회합니다.
      operationId: getCoupons
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CouponPageResponse'

  /coupons/{couponId}/issue:
    post:
      tags:
        - Coupons
      summary: 쿠폰 발급
      description: |
        사용자에게 쿠폰을 발급합니다.

        ## 발급 조건
        - 쿠폰 상태가 ACTIVE
        - 발급 가능 수량이 남아있음
        - 발급 기간 내
        - 1인당 발급 제한 미초과

        ## 동시성 제어
        선착순 발급을 위해 락을 사용합니다.
      operationId: issueCoupon
      parameters:
        - name: couponId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
              properties:
                userId:
                  type: integer
                  format: int64
      responses:
        '201':
          description: 발급 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserCouponResponse'
        '400':
          description: 발급 불가 (조건 미충족)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: 이미 발급된 쿠폰
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/{userId}/coupons:
    get:
      tags:
        - Coupons
      summary: 사용자 보유 쿠폰 조회
      description: 사용자가 보유한 쿠폰 목록을 조회합니다.
      operationId: getUserCoupons
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
        - name: status
          in: query
          description: 쿠폰 상태 필터
          schema:
            type: string
            enum: [ISSUED, USED, EXPIRED, REVOKED]
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserCouponResponse'

# ========================================
# Components
# ========================================
components:
  # Parameters
  parameters:
    UserIdPath:
      name: userId
      in: path
      required: true
      description: 사용자 ID
      schema:
        type: integer
        format: int64

    ProductIdPath:
      name: productId
      in: path
      required: true
      description: 상품 ID
      schema:
        type: integer
        format: int64

    OrderIdPath:
      name: orderId
      in: path
      required: true
      description: 주문 ID
      schema:
        type: integer
        format: int64

    PageParam:
      name: page
      in: query
      description: 페이지 번호 (0부터 시작)
      schema:
        type: integer
        default: 0
        minimum: 0

    SizeParam:
      name: size
      in: query
      description: 페이지 크기
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100

  # Schemas
  schemas:
    # Common
    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
        timestamp:
          type: string
          format: date-time

    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            error:
              type: object
              properties:
                code:
                  type: string
                  example: PRODUCT_OUT_OF_STOCK
                message:
                  type: string
                  example: 상품의 재고가 부족합니다.
                details:
                  type: object

    PageInfo:
      type: object
      properties:
        page:
          type: integer
        size:
          type: integer
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer

    # User
    CreateUserRequest:
      type: object
      required:
        - email
        - password
        - name
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 8
          example: password123
        name:
          type: string
          minLength: 2
          maxLength: 50
          example: 홍길동

    UserResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                id:
                  type: integer
                  format: int64
                email:
                  type: string
                name:
                  type: string
                balance:
                  type: number
                  format: decimal
                role:
                  type: string
                  enum: [USER, ADMIN]
                status:
                  type: string
                  enum: [ACTIVE, INACTIVE, DELETED]
                createdAt:
                  type: string
                  format: date-time

    ChargeBalanceRequest:
      type: object
      required:
        - amount
      properties:
        amount:
          type: number
          format: decimal
          minimum: 1
          example: 10000

    BalanceResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                userId:
                  type: integer
                  format: int64
                balance:
                  type: number
                  format: decimal

    BalanceHistoryResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                id:
                  type: integer
                  format: int64
                userId:
                  type: integer
                  format: int64
                type:
                  type: string
                  enum: [CHARGE, USE, REFUND]
                amount:
                  type: number
                  format: decimal
                balanceBefore:
                  type: number
                  format: decimal
                balanceAfter:
                  type: number
                  format: decimal
                description:
                  type: string
                createdAt:
                  type: string
                  format: date-time

    BalanceHistoryPageResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                content:
                  type: array
                  items:
                    $ref: '#/components/schemas/BalanceHistoryResponse'
                page:
                  type: integer
                size:
                  type: integer
                totalElements:
                  type: integer
                totalPages:
                  type: integer

    # Product
    ProductResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        price:
          type: number
          format: decimal
        stock:
          type: integer
        categoryId:
          type: integer
          format: int64
        categoryName:
          type: string
        status:
          type: string
          enum: [AVAILABLE, OUT_OF_STOCK, DISCONTINUED]

    ProductDetailResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              allOf:
                - $ref: '#/components/schemas/ProductResponse'
                - type: object
                  properties:
                    safetyStock:
                      type: integer
                    createdAt:
                      type: string
                      format: date-time
                    updatedAt:
                      type: string
                      format: date-time

    ProductPageResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                content:
                  type: array
                  items:
                    $ref: '#/components/schemas/ProductResponse'
                page:
                  type: integer
                size:
                  type: integer
                totalElements:
                  type: integer
                totalPages:
                  type: integer

    PopularProductResponse:
      type: object
      properties:
        productId:
          type: integer
          format: int64
        productName:
          type: string
        price:
          type: number
          format: decimal
        totalSalesCount:
          type: integer
        totalSalesAmount:
          type: number
          format: decimal
        rank:
          type: integer

    CategoryResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string

    RestockNotificationResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                id:
                  type: integer
                  format: int64
                userId:
                  type: integer
                  format: int64
                productId:
                  type: integer
                  format: int64
                status:
                  type: string
                  enum: [PENDING, SENT, CANCELLED]
                requestedAt:
                  type: string
                  format: date-time

    # Cart
    AddCartItemRequest:
      type: object
      required:
        - productId
        - quantity
      properties:
        productId:
          type: integer
          format: int64
        quantity:
          type: integer
          minimum: 1

    CartItemResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                id:
                  type: integer
                  format: int64
                productId:
                  type: integer
                  format: int64
                productName:
                  type: string
                price:
                  type: number
                  format: decimal
                priceAtAdd:
                  type: number
                  format: decimal
                quantity:
                  type: integer
                subtotal:
                  type: number
                  format: decimal
                isPriceChanged:
                  type: boolean

    CartResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                cartId:
                  type: integer
                  format: int64
                userId:
                  type: integer
                  format: int64
                items:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: integer
                        format: int64
                      productId:
                        type: integer
                        format: int64
                      productName:
                        type: string
                      price:
                        type: number
                        format: decimal
                      priceAtAdd:
                        type: number
                        format: decimal
                      quantity:
                        type: integer
                      subtotal:
                        type: number
                        format: decimal
                      isPriceChanged:
                        type: boolean
                totalAmount:
                  type: number
                  format: decimal
                createdAt:
                  type: string
                  format: date-time
                updatedAt:
                  type: string
                  format: date-time

    # Order
    CreateOrderRequest:
      type: object
      required:
        - userId
        - items
        - idempotencyKey
      properties:
        userId:
          type: integer
          format: int64
        items:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - productId
              - quantity
            properties:
              productId:
                type: integer
                format: int64
              quantity:
                type: integer
                minimum: 1
        userCouponIds:
          type: array
          items:
            type: integer
            format: int64
        idempotencyKey:
          type: string
          description: 중복 주문 방지를 위한 고유 키
          example: order-20251028-123456

    OrderResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                orderId:
                  type: integer
                  format: int64
                orderNumber:
                  type: string
                  example: ORD-20251028-000001
                userId:
                  type: integer
                  format: int64
                items:
                  type: array
                  items:
                    type: object
                    properties:
                      productId:
                        type: integer
                        format: int64
                      productName:
                        type: string
                      price:
                        type: number
                        format: decimal
                      quantity:
                        type: integer
                      subtotal:
                        type: number
                        format: decimal
                totalAmount:
                  type: number
                  format: decimal
                discountAmount:
                  type: number
                  format: decimal
                finalAmount:
                  type: number
                  format: decimal
                status:
                  type: string
                  enum: [PENDING, PAID, CANCELLED, REFUNDED]
                orderedAt:
                  type: string
                  format: date-time
                paidAt:
                  type: string
                  format: date-time

    OrderDetailResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              allOf:
                - $ref: '#/components/schemas/OrderResponse'
                - type: object
                  properties:
                    userName:
                      type: string
                    coupons:
                      type: array
                      items:
                        type: object
                        properties:
                          userCouponId:
                            type: integer
                            format: int64
                          couponName:
                            type: string
                          discountAmount:
                            type: number
                            format: decimal
                    payment:
                      type: object
                      properties:
                        paymentId:
                          type: integer
                          format: int64
                        method:
                          type: string
                          enum: [BALANCE]
                        amount:
                          type: number
                          format: decimal
                        status:
                          type: string
                          enum: [PENDING, COMPLETED, FAILED, CANCELLED]

    OrderPageResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                content:
                  type: array
                  items:
                    type: object
                    properties:
                      orderId:
                        type: integer
                        format: int64
                      orderNumber:
                        type: string
                      totalAmount:
                        type: number
                        format: decimal
                      discountAmount:
                        type: number
                        format: decimal
                      finalAmount:
                        type: number
                        format: decimal
                      status:
                        type: string
                      orderedAt:
                        type: string
                        format: date-time
                page:
                  type: integer
                size:
                  type: integer
                totalElements:
                  type: integer
                totalPages:
                  type: integer

    # Coupon
    CouponResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        code:
          type: string
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [FIXED_AMOUNT, PERCENTAGE]
        discountValue:
          type: number
          format: decimal
        minimumOrderAmount:
          type: number
          format: decimal
        maximumDiscountAmount:
          type: number
          format: decimal
        totalQuantity:
          type: integer
        remainingQuantity:
          type: integer
        status:
          type: string
          enum: [ACTIVE, INACTIVE, EXHAUSTED]
        issueStartAt:
          type: string
          format: date-time
        issueEndAt:
          type: string
          format: date-time
        validFrom:
          type: string
          format: date-time
        validUntil:
          type: string
          format: date-time

    CouponPageResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                content:
                  type: array
                  items:
                    $ref: '#/components/schemas/CouponResponse'
                page:
                  type: integer
                size:
                  type: integer
                totalElements:
                  type: integer
                totalPages:
                  type: integer

    UserCouponResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                userCouponId:
                  type: integer
                  format: int64
                userId:
                  type: integer
                  format: int64
                coupon:
                  type: object
                  properties:
                    id:
                      type: integer
                      format: int64
                    code:
                      type: string
                    name:
                      type: string
                    type:
                      type: string
                    discountValue:
                      type: number
                      format: decimal
                    minimumOrderAmount:
                      type: number
                      format: decimal
                    maximumDiscountAmount:
                      type: number
                      format: decimal
                status:
                  type: string
                  enum: [ISSUED, USED, EXPIRED, REVOKED]
                issuedAt:
                  type: string
                  format: date-time
                canUse:
                  type: boolean

  # Responses
  responses:
    BadRequest:
      description: 잘못된 요청
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: BAD_REQUEST
              message: 잘못된 요청입니다.
            timestamp: "2025-10-28T12:00:00"

    NotFound:
      description: 리소스를 찾을 수 없음
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: NOT_FOUND
              message: 요청한 리소스를 찾을 수 없습니다.
            timestamp: "2025-10-28T12:00:00"

    Conflict:
      description: 리소스 충돌
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: CONFLICT
              message: 이미 존재하는 리소스입니다.
            timestamp: "2025-10-28T12:00:00"

    InternalServerError:
      description: 서버 내부 오류
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: INTERNAL_SERVER_ERROR
              message: 서버 내부 오류가 발생했습니다.
            timestamp: "2025-10-28T12:00:00"

  # Security Schemes
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT 토큰을 사용한 인증

# Security
security:
  - bearerAuth: []
