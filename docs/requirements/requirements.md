## 이커머스 핵심 기능

### 1. 상품 관리
#### 기본 기능
- 상품 정보 조회 (가격, 재고)
- 재고 실시간 확인
- 인기 상품 통계 (최근 3일, Top 5)

#### 추가 필요 사항
- **상품 품절/재입고 알림**
  - 재고 0인 상품에 대한 재입고 알림 신청 기능
  - 재고 입고 시 대기자에게 자동 알림 발송
  - 알림 신청자 관리 및 알림 발송 이력 추적

- **재고 안전 재고 수준 관리**
  - 재고가 특정 수준(예: 10개) 이하로 떨어지면 관리자 알림
  - 재고 부족으로 인한 판매 기회 손실 방지
  - 상품별 최소/최대 재고 임계값 설정

- **상품 카테고리/필터링**
  - 상품 카테고리별 조회 기능
  - 가격대, 인기도, 재고 유무 등 다양한 필터 옵션
  - 검색 기능 (상품명, 설명 기반)

#### 예측하지 못한 부분 (Edge Cases)
- **동시성 제어**
  - 여러 사용자가 동시에 마지막 재고 1개를 조회/구매하려 할 때 Race Condition 발생
  - 재고 조회와 실제 구매 사이의 시간차로 인한 재고 불일치
  - 분산 환경에서 재고 동기화 문제

- **인기 상품 통계 집계 성능**
  - 실시간 통계 계산 시 대량 트래픽으로 인한 DB 부하
  - 최근 3일 데이터 범위 조회 시 인덱스 미설정으로 인한 Full Scan
  - Top 5 순위 변동 시 캐시 무효화 전략 부재

- **재고 음수 방지 처리**
  - 동시 주문으로 재고가 음수로 떨어지는 상황
  - 재고 0일 때 주문 진행 중 상태 처리
  - 취소/환불 시 재고 복구 로직 누락

---

### 2. 주문/결제 시스템
#### 기본 기능
- 장바구니 기능
- 재고 확인 및 차감
- 잔액 기반 결제
- 쿠폰 할인 적용

#### 추가 필요 사항
- **주문 취소/환불 처리**
  - 결제 완료 후 주문 취소 기능
  - 취소 시 재고 복구, 잔액 환불, 쿠폰 복구 로직
  - 부분 취소/전체 취소 지원
  - 취소 가능 시간 제한 설정 (예: 결제 후 30분 이내)

- **주문 상태 관리 및 조회**
  - 주문 상태 추적 (결제 대기 → 결제 완료 → 배송 준비 → 배송 중 → 배송 완료)
  - 사용자별 주문 내역 조회 (페이징 처리)
  - 주문 상세 정보 조회 (상품 목록, 결제 금액, 쿠폰 사용 내역)

- **장바구니 유효성 검증**
  - 장바구니에 담긴 상품의 가격 변동 감지
  - 장바구니에 담은 후 시간이 지나 재고가 소진된 경우 처리
  - 장바구니 만료 정책 (예: 24시간 후 자동 삭제)

#### 예측하지 못한 부분 (Edge Cases)
- **분산 트랜잭션 실패**
  - 잔액 차감은 성공했으나 재고 차감 실패 시 롤백 처리
  - 결제 완료 후 쿠폰 사용 처리 실패 시 보상 트랜잭션
  - 장바구니 → 주문 전환 중 네트워크 타임아웃 발생

- **중복 결제 방지**
  - 사용자가 결제 버튼을 연속으로 클릭하는 경우
  - 네트워크 지연으로 재시도 요청 시 멱등성 보장 필요
  - 동일 장바구니로 여러 주문 생성 시나리오

- **쿠폰 적용 우선순위**
  - 여러 쿠폰 동시 적용 시 할인율 계산 순서
  - 최소 주문 금액 조건 미달 시 쿠폰 자동 제거 처리
  - 쿠폰 적용 후 상품 가격 변동 시 재계산 로직

---

### 3. 쿠폰 시스템
#### 기본 기능
- 선착순 발급 (한정 수량)
- 쿠폰 유효성 검증
- 사용 이력 관리

#### 추가 필요 사항
- **다양한 쿠폰 타입 지원**
  - 정액 할인 vs 정률 할인
  - 특정 상품/카테고리 전용 쿠폰
  - 최소 주문 금액 조건부 쿠폰
  - 첫 구매 고객 전용 쿠폰

- **쿠폰 발급 전략**
  - 이벤트성 쿠폰 (특정 날짜/시간에 발급)
  - 사용자 등급별 차등 쿠폰 발급
  - 쿠폰 코드 입력 방식 vs 자동 지급 방식
  - 쿠폰 발급 수량 제한 및 1인당 발급 횟수 제한

- **쿠폰 만료 및 회수 정책**
  - 미사용 쿠폰 자동 만료 처리 (배치 작업)
  - 부정 사용 감지 시 쿠폰 회수
  - 쿠폰 사용률 통계 (발급 대비 사용 비율)

#### 예측하지 못한 부분 (Edge Cases)
- **선착순 발급 동시성**
  - 한정 수량(예: 100개) 쿠폰에 1000명이 동시 요청 시 Over-Issuing
  - Optimistic Lock vs Pessimistic Lock 선택 기준 부재
  - 발급 실패 사용자에게 대기열/재시도 안내 부재

- **쿠폰 유효성 복합 조건**
  - 쿠폰 유효기간, 사용 가능 상품 카테고리, 최소 금액 등 다중 검증
  - 쿠폰 발급 후 사용 전 만료 처리
  - 사용 중인 쿠폰의 유효기간이 만료되는 타이밍 이슈

- **쿠폰 악용 방지**
  - 한 사용자가 여러 계정으로 쿠폰 중복 발급
  - 쿠폰 코드 추측을 통한 무단 사용 시도
  - 쿠폰 사용 후 주문 취소 시 쿠폰 복구/재사용 정책

---

### 4. 데이터 연동
#### 기본 기능
- 주문 데이터 외부 전송
- 실패 시에도 주문은 정상 처리

#### 추가 필요 사항
- **전송 재시도 및 보상 메커니즘**
  - 전송 실패 시 지수 백오프(Exponential Backoff) 재시도
  - 최대 재시도 횟수 초과 시 Dead Letter Queue로 이동
  - 수동 재전송 API 제공 (관리자용)

- **데이터 전송 우선순위 관리**
  - 긴급 주문(VIP 고객 등)의 데이터 우선 전송
  - 대량 주문 시 배치 전송 vs 실시간 전송 전략
  - 외부 시스템 부하 상황 고려한 전송 속도 조절 (Rate Limiting)

- **데이터 전송 모니터링 및 추적**
  - 전송 성공/실패 통계 대시보드
  - 전송 지연 시간 모니터링 (SLA 기준)
  - 실패 원인별 분류 및 알림 (네트워크 오류, 타임아웃, 응답 오류 등)
  - 전송 로그 보관 및 검색 기능

#### 예측하지 못한 부분 (Edge Cases)
- **비동기 전송 신뢰성**
  - 외부 API 타임아웃 시 재시도 로직 및 최대 재시도 횟수
  - 메시지 큐 사용 시 메시지 유실 방지 (Dead Letter Queue)
  - 전송 실패 데이터 수동 재처리를 위한 모니터링 부재

- **데이터 정합성**
  - 주문 생성과 외부 전송 사이의 데이터 불일치 (주문 수정/취소)
  - 외부 시스템에는 전송 성공했으나 응답 수신 실패 시 중복 전송
  - 부분 실패 시 어디까지 전송되었는지 추적 불가

- **외부 의존성 장애**
  - 외부 시스템 장애가 길어질 때 대기 중인 데이터 증가로 인한 메모리 부족
  - 전송 실패해도 주문은 정상 처리되지만, 외부 시스템 복구 후 일괄 동기화 방법 부재
  - Circuit Breaker 패턴 미적용 시 연쇄 장애 가능성

